<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.2.0/dist/aframe-extras.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Varela+Round&display=swap" rel="stylesheet">

    <style>
      /* --- CORE SETUP --- */
      html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background-color: transparent !important; font-family: 'Varela Round', sans-serif; }
      canvas { background-color: transparent !important; }

      /* --- ANIMAL CROSSING PALETTE --- */
      :root {
        --nook-cream: #fffcf2;
        --nook-green: #8dd7bd;
        --nook-dark-green: #6ebca4;
        --nook-brown: #786b59;
        --nook-orange: #f4a261;
        --nook-red: #e76f51;
        --nook-blue: #70c1b3;
        --nook-blue-dark: #589a8e;
        --nook-pink: #ffc8dd; 
        --nook-pink-dark: #e598b2;
      }

      /* --- MODAL STYLES --- */
      .nook-modal {
        display: none; position: absolute; top: 50%; left: 50%;
        transform: translate(-50%, -50%); 
        background: var(--nook-cream); color: var(--nook-brown);
        padding: 20px; border-radius: 30px; 
        border: 5px solid white; outline: 5px solid #f2e3c9;
        z-index: 2000;
        box-shadow: 0 10px 20px rgba(0,0,0,0.2); 
        text-align: left;
        max-height: 85vh; overflow-y: auto;
      }

      /* --- FULL SCREEN LIST OVERRIDE --- */
      #list-panel {
        width: 100%; height: 100%; 
        max-height: 100%; max-width: 100%;
        top: 0; left: 0; 
        transform: none; 
        border-radius: 0; 
        border: none; outline: none;
        z-index: 3000; 
        padding: 30px;
        box-sizing: border-box;
      }

      /* Other Panels */
      #input-panel { width: 85%; max-width: 350px; z-index: 4000; }
      #breathe-panel { width: 90%; height: 80%; }
      #customize-panel { width: 85%; max-width: 320px; text-align: center; } 
      #encouragement-modal { width: 85%; max-width: 320px; text-align: center; z-index: 5000; } 
      #lost-tracking-modal { width: 85%; max-width: 320px; text-align: center; }
      #make-card-panel { width: 85%; max-width: 320px; text-align: center; }

      h3 { text-align: center; margin-top: 0; color: var(--nook-green); font-size: 22px; border-bottom: 2px dashed #e0d6c3; padding-bottom: 10px; }

      /* --- FORM ELEMENTS --- */
      label { font-size: 14px; font-weight: bold; display: block; margin-top: 8px; margin-bottom: 4px; }
      input, select {
        width: 100%; padding: 10px; border-radius: 15px; border: 2px solid #e0d6c3;
        background: white; color: var(--nook-brown); font-family: 'Varela Round', sans-serif; box-sizing: border-box;
      }
      input:focus { outline: none; border-color: var(--nook-green); }

      /* Buttons */
      .nook-btn {
        width: 100%; padding: 12px; margin-top: 15px; border: none; border-radius: 25px;
        font-family: 'Varela Round', sans-serif; font-size: 16px; font-weight: bold;
        cursor: pointer; color: white; transition: transform 0.1s;
      }
      .btn-save { background: var(--nook-green); box-shadow: 0 4px 0 var(--nook-dark-green); }
      .btn-cancel { background: #d6ccc2; box-shadow: 0 4px 0 #b0a8a0; color: #555; margin-top: 10px; }
      .nook-btn:active { transform: translateY(4px); box-shadow: none; }

      /* --- FLOATING UI --- */
      #add-btn { position: absolute; bottom: 30px; right: 30px; z-index: 1000; width: 60px; height: 60px; border-radius: 50%; background: var(--nook-green); color: white; border: 4px solid white; font-size: 30px; font-weight: bold; box-shadow: 0 4px 0 var(--nook-dark-green); cursor: pointer; }
      #breathe-btn { position: absolute; bottom: 30px; left: 30px; z-index: 1000; padding: 15px 20px; border-radius: 30px; background: var(--nook-pink); color: white; border: 4px solid white; font-size: 16px; font-weight: bold; box-shadow: 0 4px 0 var(--nook-pink-dark); cursor: pointer; }
      #list-btn { position: absolute; top: 30px; right: 30px; z-index: 1000; padding: 10px 15px; border-radius: 20px; background: var(--nook-blue); color: white; border: 3px solid white; font-size: 14px; font-weight: bold; box-shadow: 0 4px 0 #4a9d91; cursor: pointer; }
      #customize-btn { position: absolute; top: 30px; left: 30px; z-index: 1000; padding: 10px 15px; border-radius: 20px; background: var(--nook-blue); color: white; border: 3px solid white; font-size: 14px; font-weight: bold; box-shadow: 0 4px 0 var(--nook-blue-dark); cursor: pointer; }

      #start-btn { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 9999; padding: 15px 30px; background: var(--nook-blue); color: white; font-family: 'Varela Round', sans-serif; font-size: 18px; border: none; border-radius: 20px; box-shadow: 0 5px 0 #4a9d91; cursor: pointer; }

      /* List Styles */
      .task-item { background: white; border-radius: 15px; padding: 15px; margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
      .task-info { text-align: left; }
      .task-title { font-weight: bold; font-size: 16px; }
      .task-meta { font-size: 12px; color: #999; }
      .btn-complete { background: var(--nook-green); color: white; border: none; padding: 8px 12px; border-radius: 10px; cursor: pointer; font-size: 12px; }

      /* Breathe Styles */
      .breathe-item { background: #fdf0f5; padding: 20px; border-radius: 15px; margin-bottom: 15px; color: #d48bb3; font-weight: bold; text-align: center; border: 2px dashed #f5cdda; }

      #debug-log { position: absolute; top: 10px; left: 10px; color: red; background: rgba(255,255,255,0.8); padding: 5px; z-index: 10000; font-family: monospace; font-size: 10px; pointer-events: none; border-radius: 5px; }
      .urgency-container { display: flex; justify-content: space-between; margin-top: 5px; }
      .urgency-option { cursor: pointer; padding: 8px 5px; border-radius: 15px; border: 2px solid #eee; background: white; flex: 1; text-align: center; margin: 0 3px; font-size: 20px; }
      .urgency-option.selected-chill { background: #d8f3dc; border-color: #95d5b2; }
      .urgency-option.selected-warn { background: #ffedd5; border-color: var(--nook-orange); }
      .urgency-option.selected-hot { background: #ffccd5; border-color: var(--nook-red); }
      .date-time-row { display: flex; gap: 10px; } .date-time-row div { flex: 1; }
    </style>
  </head>
  <body>

    <div id="debug-log">Status: Ready</div>
    <button id="start-btn">Start Ankor Tasks</button>
    
    <button id="add-btn" onclick="openModal('input-panel')">+</button>
    <button id="breathe-btn" onclick="openModal('breathe-panel')">üå∏ Breathe</button>
    <button id="list-btn" onclick="openTaskList()">üìã All Tasks</button>
    <button id="customize-btn" onclick="openModal('customize-panel')">Customize</button>

    <div id="input-panel" class="nook-modal">
      <h3>üçÉ New Task üçÉ</h3>
      <label>What needs doing?</label>
      <input type="text" id="task-name" placeholder="e.g. Math Quiz...">
      
      <label>Class / Category</label>
      <select id="task-category" onchange="checkNewCategory(this)">
        <option value="General">General ‚ö™</option>
        <option value="Math">Math üîµ</option>
        <option value="Science">Science üü¢</option>
        <option value="History">History üî¥</option>
        <option value="Art">Art üü°</option>
        <option value="new">+ Create New...</option>
      </select>
      <input type="text" id="new-category-input" placeholder="Enter Category Name" style="display:none; margin-top:5px;">

      <div class="date-time-row">
        <div><label>Due Date</label><input type="date" id="task-due"></div>
        <div><label>Time</label><input type="time" id="task-time"></div>
      </div>

      <label>Urgency</label>
      <div class="urgency-container">
        <div class="urgency-option" id="opt-chill" onclick="selectUrgency('chill')">üåø<br><span style="font-size:10px">Chill</span></div>
        <div class="urgency-option" id="opt-warn" onclick="selectUrgency('warn')">‚ö†Ô∏è<br><span style="font-size:10px">Important</span></div>
        <div class="urgency-option" id="opt-hot" onclick="selectUrgency('hot')">üî•<br><span style="font-size:10px">ASAP</span></div>
      </div>

      <label>Reminders</label>
      <select id="task-reminder">
        <option value="none">No Reminders</option>
        <option value="daily">Daily until due</option>
        <option value="morning">Morning of due date</option>
      </select>

      <button class="nook-btn btn-save" onclick="saveTask()">I'll do it!</button>
      <button class="nook-btn btn-cancel" onclick="closeModal('input-panel')">Nevermind</button>
    </div>

    <div id="list-panel" class="nook-modal">
      <h3>üìã Your To-Do List</h3>
      <button class="nook-btn" style="background:var(--nook-green); margin-bottom:20px;" onclick="openModal('input-panel')">+ Add New Task</button>
      <div id="task-list-container">
        <p style="text-align:center; color:#999;">No tasks yet! Go add some.</p>
      </div>
      <button class="nook-btn btn-cancel" onclick="closeModal('list-panel'); resetTrackingLogic()">Return to Scanner</button>
    </div>

    <div id="breathe-panel" class="nook-modal">
      <h3 style="color: var(--nook-pink-dark)">üå∏ Breathing Room</h3>
      <p style="text-align:center; font-style:italic; margin-bottom:20px;">Breathing Exercises Coming Soon...</p>
      <div class="breathe-item">Box Breathing (4-4-4-4)</div>
      <div class="breathe-item">Relaxing Breath (4-7-8)</div>
      <div class="breathe-item">Mindful Minute</div>
      <button class="nook-btn btn-cancel" onclick="closeModal('breathe-panel')">Close</button>
    </div>

    <div id="customize-panel" class="nook-modal">
      <h3>üé® Customize</h3>
      <p style="margin: 30px 0; font-size:18px;">Customization Options<br>Coming Soon...</p>
      <button class="nook-btn btn-cancel" onclick="closeModal('customize-panel')">Close</button>
    </div>

    <div id="encouragement-modal" class="nook-modal">
      <h3 style="color: var(--nook-orange)">Don't Give Up! üåü</h3>
      <p style="font-size:16px; margin: 20px 0;">It looks like a task is past its due date.</p>
      <p style="font-style:italic; color:#777;">"It's not the end of the world! You'll do better next time. Keep moving forward!"</p>
      <button class="nook-btn" style="background:var(--nook-orange)" onclick="closeModal('encouragement-modal')">I got this!</button>
    </div>

    <div id="lost-tracking-modal" class="nook-modal">
      <h3>‚ö†Ô∏è Signal Lost...</h3>
      <p>Ankor Card not detected for 15s.</p>
      <button class="nook-btn" style="background:var(--nook-blue)" onclick="openMakeCard()">Make a New One</button>
      <button class="nook-btn" style="background:var(--nook-green)" onclick="render2DList(); openModal('list-panel'); closeModal('lost-tracking-modal')">Go to Task List</button>
      <button class="nook-btn btn-cancel" onclick="resetTrackingLogic()">Keep Searching</button>
    </div>

    <div id="make-card-panel" class="nook-modal">
      <h3>üõ†Ô∏è Crafting Table</h3>
      <p style="margin: 30px 0; font-size:18px;">New Card Creator<br>Coming Soon...</p>
      <button class="nook-btn btn-cancel" onclick="closeModal('make-card-panel'); resetTrackingLogic()">Return</button>
    </div>

    <a-scene 
      mindar-image="imageTargetSrc: ./targets.mind; autoStart: false; missTolerance: 10;" 
      color-space="sRGB" 
      renderer="colorManagement: true, physicallyCorrectLights; alpha: true" 
      vr-mode-ui="enabled: false" 
      device-orientation-permission-ui="enabled: false">
      
      <a-assets>
        <a-asset-item id="ankorModel" src="./ankor_pal.glb"></a-asset-item>
      </a-assets>

      <a-camera position="0 0 0" look-controls="enabled: false" cursor="fuse: false; rayOrigin: mouse;" raycaster="far: 10000; objects: .clickable"></a-camera>

      <a-entity mindar-image-target="targetIndex: 0" class="ar-target">
        <a-entity class="model-wrapper">
          <a-gltf-model class="clickable model" src="#ankorModel" position="0 0 0" scale="0.8 0.8 0.8" rotation="-20 0 0" animation-mixer></a-gltf-model>
          <a-entity class="task-bubble" position="0 1.5 0" visible="false">
             <a-plane color="#fffcf2" width="2.4" height="2.0" opacity="0.95"></a-plane>
             <a-text value="Ankor Tasks" color="#8dd7bd" align="center" width="4" position="0 0.8 0.1" font="kelsonsans" wrap-count="20"></a-text>
             <a-text class="bubble-text" value="No tasks yet!" color="#786b59" align="center" width="2.2" position="0 0.1 0.1" font="kelsonsans" wrap-count="25"></a-text>
             <a-entity class="finish-group" position="0 -0.6 0.1" visible="false">
                <a-plane class="clickable done-btn" color="#8dd7bd" width="1.2" height="0.4" opacity="1"></a-plane>
                <a-text value="Finish Task" align="center" width="3" color="white" position="0 0 0.1" pointer-events="none"></a-text>
             </a-entity>
             <a-triangle color="#fffcf2" vertex-a="0 -1.1 0" vertex-b="-0.2 -1.0 0" vertex-c="0.2 -1.0 0"></a-triangle>
          </a-entity>
        </a-entity>
      </a-entity>

      <a-entity mindar-image-target="targetIndex: 1" class="ar-target">
        <a-entity class="model-wrapper">
          <a-gltf-model class="clickable model" src="#ankorModel" position="0 0 0" scale="0.8 0.8 0.8" rotation="-20 0 0" animation-mixer></a-gltf-model>
          <a-entity class="task-bubble" position="0 1.5 0" visible="false">
             <a-plane color="#fffcf2" width="2.4" height="2.0" opacity="0.95"></a-plane>
             <a-text value="Ankor Tasks" color="#8dd7bd" align="center" width="4" position="0 0.8 0.1" font="kelsonsans" wrap-count="20"></a-text>
             <a-text class="bubble-text" value="No tasks yet!" color="#786b59" align="center" width="2.2" position="0 0.1 0.1" font="kelsonsans" wrap-count="25"></a-text>
             <a-entity class="finish-group" position="0 -0.6 0.1" visible="false">
                <a-plane class="clickable done-btn" color="#8dd7bd" width="1.2" height="0.4" opacity="1"></a-plane>
                <a-text value="Finish Task" align="center" width="3" color="white" position="0 0 0.1" pointer-events="none"></a-text>
             </a-entity>
             <a-triangle color="#fffcf2" vertex-a="0 -1.1 0" vertex-b="-0.2 -1.0 0" vertex-c="0.2 -1.0 0"></a-triangle>
          </a-entity>
        </a-entity>
      </a-entity>

      <a-entity mindar-image-target="targetIndex: 2" class="ar-target">
        <a-entity class="model-wrapper">
          <a-gltf-model class="clickable model" src="#ankorModel" position="0 0 0" scale="0.8 0.8 0.8" rotation="-20 0 0" animation-mixer></a-gltf-model>
          <a-entity class="task-bubble" position="0 1.5 0" visible="false">
             <a-plane color="#fffcf2" width="2.4" height="2.0" opacity="0.95"></a-plane>
             <a-text value="Ankor Tasks" color="#8dd7bd" align="center" width="4" position="0 0.8 0.1" font="kelsonsans" wrap-count="20"></a-text>
             <a-text class="bubble-text" value="No tasks yet!" color="#786b59" align="center" width="2.2" position="0 0.1 0.1" font="kelsonsans" wrap-count="25"></a-text>
             <a-entity class="finish-group" position="0 -0.6 0.1" visible="false">
                <a-plane class="clickable done-btn" color="#8dd7bd" width="1.2" height="0.4" opacity="1"></a-plane>
                <a-text value="Finish Task" align="center" width="3" color="white" position="0 0 0.1" pointer-events="none"></a-text>
             </a-entity>
             <a-triangle color="#fffcf2" vertex-a="0 -1.1 0" vertex-b="-0.2 -1.0 0" vertex-c="0.2 -1.0 0"></a-triangle>
          </a-entity>
        </a-entity>
      </a-entity>

    </a-scene>

    <script>
      let myTasks = []; 
      let selectedUrgency = 'chill'; 
      
      let lastSeenTime = 0; 
      let isTrackingLost = false;
      let visibleCount = 0;
      let cameraActive = false;
      let isModalOpen = false;

      const debugLog = document.getElementById('debug-log');
      const startBtn = document.getElementById('start-btn');
      const scene = document.querySelector('a-scene');
      
      const taskNameInput = document.getElementById('task-name');
      const taskCatInput = document.getElementById('task-category');
      const newCatInput = document.getElementById('new-category-input');
      const taskDueInput = document.getElementById('task-due');
      const taskTimeInput = document.getElementById('task-time');

      // --- 1. START CAMERA ---
      startBtn.addEventListener('click', () => {
        debugLog.innerText = "Status: Starting Ankor Tasks...";
        startBtn.style.display = 'none'; 
        const mindAR = scene.systems['mindar-image-system'];
        mindAR.start()
          .then(() => { 
             debugLog.innerText = "Status: Ankor Tasks Active"; 
             cameraActive = true; 
             lastSeenTime = Date.now();
             startHeartbeat(); // Start the 1-second checker
          })
          .catch(err => { 
             console.error(err); alert("Camera Error: " + err); 
             startBtn.style.display = 'block'; 
          });
      });

      // --- 2. HEARTBEAT TRACKING LOGIC ---
      function startHeartbeat() {
          setInterval(() => {
              if(!cameraActive) return;
              if(isModalOpen) {
                  lastSeenTime = Date.now(); // Reset timer if user is in a menu
                  return; 
              }
              
              const now = Date.now();
              const timeSinceSeen = (now - lastSeenTime) / 1000;

              if(visibleCount > 0) {
                  lastSeenTime = now;
                  if(isTrackingLost) {
                      isTrackingLost = false;
                      closeModal('lost-tracking-modal');
                  }
                  debugLog.innerText = "Status: Tracking Active";
              } else {
                  debugLog.innerText = `Status: Searching (${Math.floor(timeSinceSeen)}s)...`;
                  
                  if(timeSinceSeen > 15 && !isTrackingLost) {
                      isTrackingLost = true;
                      openModal('lost-tracking-modal');
                  }
              }
          }, 1000);
      }

      function resetTrackingLogic() {
         isTrackingLost = false;
         lastSeenTime = Date.now();
         closeModal('lost-tracking-modal');
      }

      function openMakeCard() {
         closeModal('lost-tracking-modal');
         openModal('make-card-panel');
      }

      const targets = document.querySelectorAll('.ar-target');
      targets.forEach(target => {
         target.addEventListener("targetFound", () => {
            visibleCount++;
         });
         target.addEventListener("targetLost", () => {
            visibleCount--;
            if(visibleCount < 0) visibleCount = 0;
         });
      });

      // --- 3. CLICK HANDLERS ---
      const models = document.querySelectorAll('.model');
      models.forEach(model => {
        model.addEventListener("click", event => {
          event.stopPropagation();
          const wrapper = model.parentElement; 
          const bubble = wrapper.querySelector('.task-bubble');
          const isVisible = bubble.getAttribute('visible');
          bubble.setAttribute('visible', !isVisible);

          if (!isVisible) {
              const cameraPos = new THREE.Vector3();
              scene.camera.el.object3D.getWorldPosition(cameraPos);
              wrapper.object3D.lookAt(cameraPos.x, wrapper.object3D.position.y, cameraPos.z);
          } else {
              wrapper.object3D.rotation.set(0, 0, 0);
          }
        });
      });

      const doneBtns = document.querySelectorAll('.done-btn');
      doneBtns.forEach(btn => {
        btn.addEventListener("click", event => {
          event.stopPropagation();
          if (myTasks.length > 0) {
            finishTask(0); 
          } else {
            debugLog.innerText = "Status: No tasks to finish!";
          }
        });
      });

      // --- 4. UI HELPERS ---
      function openModal(id) { 
          document.getElementById(id).style.display = 'block'; 
          isModalOpen = true; 
      }
      
      function closeModal(id) { 
          document.getElementById(id).style.display = 'none'; 
          // Delay resetting isModalOpen slightly to prevent instant-trigger of lost tracking
          setTimeout(() => { isModalOpen = false; lastSeenTime = Date.now(); }, 100);
      }

      function openTaskList() {
          render2DList();
          openModal('list-panel');
          checkOverdueTasks();
      }

      function checkNewCategory(selectObj) {
        document.getElementById('new-category-input').style.display = (selectObj.value === 'new') ? 'block' : 'none';
      }

      function selectUrgency(level) {
        selectedUrgency = level;
        document.getElementById('opt-chill').className = 'urgency-option';
        document.getElementById('opt-warn').className = 'urgency-option';
        document.getElementById('opt-hot').className = 'urgency-option';
        document.getElementById('opt-' + level).classList.add('selected-' + level);
      }
      selectUrgency('chill');

      // --- 5. TASK LOGIC ---
      function saveTask() {
        if(myTasks.length >= 10) {
            alert("‚ö†Ô∏è Pockets Full! \n\nYou can only have 10 active tasks.\nPlease finish one before adding more.");
            return;
        }

        const name = taskNameInput.value;
        if(!name) return;

        let urgencyIcon = "üåø";
        if(selectedUrgency === 'warn') urgencyIcon = "‚ö†Ô∏è";
        if(selectedUrgency === 'hot') urgencyIcon = "üî•";

        let catValue = taskCatInput.value;
        if(catValue === 'new') catValue = newCatInput.value || "General";
        
        let catIcon = "‚ö™";
        if(catValue === 'Math') catIcon = "üîµ";
        if(catValue === 'Science') catIcon = "üü¢";
        if(catValue === 'History') catIcon = "üî¥";
        if(catValue === 'Art') catIcon = "üü°";

        let timeDisplay = "";
        if(taskDueInput.value) {
            const d = new Date(taskDueInput.value + 'T00:00');
            timeDisplay = `(Due: ${d.getMonth()+1}/${d.getDate()}`;
            if(taskTimeInput.value) {
                let [hours, mins] = taskTimeInput.value.split(':');
                let ampm = hours >= 12 ? 'PM' : 'AM';
                hours = hours % 12;
                hours = hours ? hours : 12; 
                timeDisplay += ` @ ${hours}:${mins} ${ampm}`;
            }
            timeDisplay += ")";
        }

        const newTask = {
            id: Date.now(),
            name: name,
            category: catValue,
            catIcon: catIcon,
            urgency: urgencyIcon,
            timeStr: timeDisplay,
            rawDate: taskDueInput.value,
            arString: `${urgencyIcon} ${catIcon} ${name}\n   ${timeDisplay}`
        };
        
        myTasks.push(newTask);
        update3DView();
        
        if(document.getElementById('list-panel').style.display === 'block') {
            render2DList();
        }

        taskNameInput.value = "";
        taskDueInput.value = "";
        taskTimeInput.value = "";
        closeModal('input-panel');
      }

      function finishTask(index) {
        myTasks.splice(index, 1);
        update3DView();
        render2DList(); 
        debugLog.innerText = "Status: Task Completed! ‚ú®";
      }

      function update3DView() {
         const hasTasks = myTasks.length > 0;
         const textContent = myTasks.map(t => t.arString).join("\n\n");
         
         const allBubbles = document.querySelectorAll('.bubble-text');
         allBubbles.forEach(text => {
            if(!hasTasks) {
                text.setAttribute('value', "No tasks yet! \n You are all caught up.");
            } else {
                text.setAttribute('value', textContent);
            }
         });

         const finishGroups = document.querySelectorAll('.finish-group');
         finishGroups.forEach(group => {
             group.setAttribute('visible', hasTasks);
             const btn = group.querySelector('.done-btn');
             if(hasTasks) btn.classList.add('clickable');
             else btn.classList.remove('clickable');
         });
      }

      function render2DList() {
        const container = document.getElementById('task-list-container');
        container.innerHTML = ""; 

        if(myTasks.length === 0) {
            container.innerHTML = '<p style="text-align:center; color:#999;">No tasks yet! Go add some.</p>';
            return;
        }

        myTasks.forEach((task, index) => {
            const div = document.createElement('div');
            div.className = 'task-item';
            div.innerHTML = `
                <div class="task-info">
                    <div class="task-title">${task.urgency} ${task.catIcon} ${task.name}</div>
                    <div class="task-meta">${task.category} ‚Ä¢ ${task.timeStr}</div>
                </div>
                <button class="btn-complete" onclick="finishTask(${index})">Done ‚úî</button>
            `;
            container.appendChild(div);
        });
      }

      // --- 6. OVERDUE LOGIC ---
      function checkOverdueTasks() {
          const today = new Date();
          today.setHours(0,0,0,0);
          
          let hasOverdue = false;
          
          myTasks.forEach(task => {
              if(task.rawDate) {
                  const dueDate = new Date(task.rawDate + 'T00:00');
                  if(dueDate < today) {
                      hasOverdue = true;
                  }
              }
          });

          if(hasOverdue) {
              openModal('encouragement-modal');
          }
      }
    </script>
  </body>
</html>